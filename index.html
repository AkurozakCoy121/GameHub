<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KingzStore - Akun Steam & Roblox Murah & Terpercaya</title>
    <!-- Tailwind CSS CDN untuk styling modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Font 'Inter' dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-yellow: #FFD700;
            --secondary-white: #FFFFFF;
            --text-gray: #4A4A4A;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--secondary-white);
            color: var(--text-gray);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 1rem;
        }

        .nav-link {
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--primary-yellow);
        }

        .btn {
            background-color: var(--primary-yellow);
            color: var(--text-gray);
            border-radius: 9999px;
            font-weight: 600;
            padding: 0.75rem 2rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .card {
            background-color: #f7f7f7;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: scale(1.03);
        }

        .game-logo-container {
            display: flex;
            position: relative;
            height: 100px;
            overflow: hidden;
            border-radius: 1rem;
            padding: 0;
            margin: 0;
        }

        .game-logo {
            width: 100px;
            height: 100px;
            object-fit: cover;
            position: absolute;
            transition: transform 0.3s;
            border-radius: 0.75rem;
        }

        .game-logo:nth-child(1) {
            top: 0;
            left: 0;
            z-index: 30;
            transform: rotate(-5deg);
        }

        .game-logo:nth-child(2) {
            top: 15px;
            left: 40px;
            z-index: 20;
            transform: rotate(5deg);
        }

        .game-logo:nth-child(3) {
            top: 30px;
            left: 80px;
            z-index: 10;
            transform: rotate(-3deg);
        }
        
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--secondary-white);
            color: var(--text-gray);
            border-radius: 1rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: fadeIn 0.3s ease-in-out;
        }

        .loading-screen {
            background-color: var(--primary-yellow);
            color: var(--secondary-white);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .dots span {
            animation: pulse 1.5s infinite;
        }

        .dots span:nth-child(2) {
            animation-delay: 0.5s;
        }

        .dots span:nth-child(3) {
            animation-delay: 1s;
        }

        .maintenance-overlay {
            z-index: 2000;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: none; /* Default to hidden */
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .admin-panel {
            display: none; /* Hidden by default */
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 loading-screen">
        <div class="text-2xl md:text-3xl font-bold mb-4">KingzStore</div>
        <div class="text-sm text-center px-4">Chat <span class="font-bold">81944589876</span> jika memiliki masalah.</div>
        <div class="dots mt-4">
            <span class="inline-block w-3 h-3 bg-white rounded-full mx-1"></span>
            <span class="inline-block w-3 h-3 bg-white rounded-full mx-1"></span>
            <span class="inline-block w-3 h-3 bg-white rounded-full mx-1"></span>
        </div>
    </div>
    
    <!-- Maintenance Overlay -->
    <div id="maintenance-overlay" class="fixed inset-0 maintenance-overlay">
        <h1 class="text-4xl md:text-6xl font-extrabold text-red-500">MAINTENANCE</h1>
        <p class="mt-4 text-xl text-center">Website sedang dalam perbaikan untuk layanan yang lebih baik.</p>
        <p class="text-center">Silakan coba lagi nanti.</p>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="min-h-screen flex flex-col">
        <!-- Header & Navbar -->
        <header class="bg-white sticky top-0 z-50 shadow-md">
            <nav class="container flex flex-wrap justify-between items-center py-4">
                <a href="#home" class="flex items-center space-x-2">
                    <img src="https://iili.io/Kdi9uHl.jpg" alt="KingzStore Logo" class="h-10 rounded-full">
                    <span class="text-xl md:text-2xl font-bold text-gray-800">KingzStore</span>
                </a>
                <div class="flex items-center space-x-4 md:hidden">
                    <button id="login-btn-mobile" class="text-gray-600 font-medium hover:text-yellow-500">Masuk</button>
                    <button id="menu-btn" class="text-gray-600 focus:outline-none">
                        <i class="fas fa-bars fa-lg"></i>
                    </button>
                </div>
                <div id="nav-menu" class="hidden md:flex flex-grow justify-end md:space-x-8 mt-4 md:mt-0 w-full md:w-auto">
                    <a href="#home" class="nav-link text-gray-600 font-medium hover:text-yellow-500">Beranda</a>
                    <a href="#steam" class="nav-link text-gray-600 font-medium hover:text-yellow-500">Akun Steam</a>
                    <a href="#roblox" class="nav-link text-gray-600 font-medium hover:text-yellow-500">Akun Roblox</a>
                    <a href="#about" class="nav-link text-gray-600 font-medium hover:text-yellow-500">Tentang Kami</a>
                    <a href="#contact" class="nav-link text-gray-600 font-medium hover:text-yellow-500">Kontak</a>
                    <button id="login-btn-desktop" class="text-gray-600 font-medium hover:text-yellow-500">Masuk</button>
                </div>
            </nav>
        </header>

        <!-- Sections -->
        <main class="flex-grow">
            <!-- Beranda Section -->
            <section id="home" class="container py-16 text-center">
                <h1 class="text-4xl md:text-6xl font-extrabold text-gray-800 leading-tight">
                    Temukan Akun Gaming Impianmu di <span class="text-yellow-500">KingzStore</span>
                </h1>
                <p class="mt-4 text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
                    Menyediakan akun Steam & Roblox berkualitas, terpercaya, dan dengan harga terbaik.
                </p>
                <div class="mt-8 flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <a href="#steam" class="btn">Lihat Akun Steam</a>
                    <a href="#roblox" class="btn bg-gray-200 hover:bg-gray-300 transform-none hover:scale-100">Lihat Akun Roblox</a>
                </div>
            </section>

            <!-- Steam Accounts Section -->
            <section id="steam" class="container py-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Akun Steam Pilihan</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="steam-accounts-container">
                    <!-- Cards will be dynamically inserted here -->
                </div>
            </section>
            
            <!-- Roblox Accounts Section -->
            <section id="roblox" class="container py-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Akun & Jasa Roblox</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Grow a Garden Account -->
                    <div class="card p-6 flex flex-col items-center text-center">
                        <i class="fas fa-seedling text-yellow-500 text-5xl mb-4"></i>
                        <h3 class="text-2xl font-semibold text-gray-800">Akun Grow A Garden</h3>
                        <p class="text-gray-600 mt-2 flex-grow">Akun-akun dengan progres di game Grow A Garden yang siap untuk dimainkan.</p>
                        <p class="text-xl font-bold text-gray-800 mt-4">Mulai dari Rp 50.000</p>
                        <button class="btn mt-4 w-full purchase-btn" data-product="Akun Grow A Garden">Pesan Sekarang</button>
                    </div>

                    <!-- Joki Akun CDID -->
                    <div class="card p-6 flex flex-col items-center text-center">
                        <i class="fas fa-arrow-up-from-bracket text-yellow-500 text-5xl mb-4"></i>
                        <h3 class="text-2xl font-semibold text-gray-800">Joki Akun CDID</h3>
                        <p class="text-gray-600 mt-2 flex-grow">Jasa joki level CDID dari 1 hingga 100 juta dengan proses cepat dan aman.</p>
                        <p class="text-xl font-bold text-gray-800 mt-4">Harga Tergantung Level</p>
                        <button class="btn mt-4 w-full purchase-btn" data-product="Joki Akun CDID">Pesan Sekarang</button>
                    </div>

                    <!-- Joki Quest Kemerdekaan -->
                    <div class="card p-6 flex flex-col items-center text-center">
                        <img src="https://iili.io/KdiYZ5x.jpg" alt="Logo Kemerdekaan" class="w-24 h-24 object-cover rounded-full mb-4">
                        <h3 class="text-2xl font-semibold text-gray-800">Joki Quest Kemerdekaan</h3>
                        <p class="text-gray-600 mt-2 flex-grow">
                            Selesaikan Quest Kemerdekaan Anda dengan cepat. Proses hanya <span class="font-bold">30 menit!</span>
                        </p>
                        <p class="text-xl font-bold text-gray-800 mt-4">Rp 10.000</p>
                        <button class="btn mt-4 w-full purchase-btn" data-product="Joki Quest Kemerdekaan">Pesan Sekarang</button>
                    </div>
                </div>
            </section>
            
            <!-- About Us Section -->
            <section id="about" class="container py-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">Tentang Kami</h2>
                <div class="bg-gray-200 rounded-2xl p-8 max-w-4xl mx-auto">
                    <p class="text-lg text-gray-700 leading-relaxed text-center">
                        KingzStore tidak hanya menyediakan akun Steam, tapi juga menyediakan akun Roblox berkualitas. Kami berkomitmen untuk memberikan pengalaman jual beli yang aman, cepat, dan terpercaya bagi para gamer. Dengan koleksi akun yang bervariasi dan layanan pelanggan yang responsif, kami siap membantu Anda menemukan akun gaming yang sesuai dengan kebutuhan Anda.
                    </p>
                </div>
            </section>
            
            <!-- Legal Section -->
            <section id="legal" class="container py-16">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-gray-200 rounded-2xl p-8">
                        <h3 class="text-2xl font-semibold mb-4">Privacy Policy</h3>
                        <p class="text-sm text-gray-700">Kami menghargai privasi Anda. Kebijakan Privasi ini menjelaskan bagaimana kami mengumpulkan, menggunakan, dan melindungi informasi pribadi Anda. Kami tidak akan pernah membagikan data Anda kepada pihak ketiga tanpa persetujuan Anda.</p>
                    </div>
                    <div class="bg-gray-200 rounded-2xl p-8">
                        <h3 class="text-2xl font-semibold mb-4">Terms of Use</h3>
                        <p class="text-sm text-gray-700">Dengan menggunakan website ini, Anda menyetujui Syarat & Ketentuan Penggunaan kami. Syarat ini mencakup aturan mengenai pembelian, penggunaan akun, dan tanggung jawab pengguna. Pastikan Anda membacanya dengan seksama.</p>
                    </div>
                </div>
            </section>
            
            <!-- Contact Section -->
            <section id="contact" class="container py-16 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-8">Hubungi Kami</h2>
                <div class="space-y-4 text-lg">
                    <p class="text-gray-700">
                        Untuk pembelian akun dan pertanyaan, silakan hubungi kami via WhatsApp:<br>
                        <a href="https://wa.me/6281944589876" class="text-yellow-500 font-bold hover:underline">81944589876</a>
                    </p>
                    <p class="text-gray-700">
                        Ikuti kami di media sosial untuk update terbaru:<br>
                        <a href="https://instagram.com/Kingzzstore" class="text-yellow-500 font-bold hover:underline">@Kingzzstore</a>
                    </p>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-8">
            <div class="container text-center text-sm text-gray-400">
                &copy; 2024 KingzStore. All Rights Reserved.
            </div>
        </footer>
    </div>
    
    <!-- Admin Panel -->
    <div id="admin-panel" class="min-h-screen p-8 bg-gray-100 hidden">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">KingzStore Admin Panel</h1>
            <button id="logout-btn" class="btn text-sm">Logout</button>
        </div>
        
        <!-- Tab Navigation -->
        <div class="border-b border-gray-300 mb-4">
            <nav class="flex space-x-4">
                <button class="tab-btn py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent transition duration-300 ease-in-out hover:border-yellow-500 active-tab" data-tab="orders">Pesanan</button>
                <button class="tab-btn py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent transition duration-300 ease-in-out hover:border-yellow-500" data-tab="products">Produk</button>
                <button class="tab-btn py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent transition duration-300 ease-in-out hover:border-yellow-500" data-tab="users">Pengguna</button>
                <button class="tab-btn py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent transition duration-300 ease-in-out hover:border-yellow-500" data-tab="ads">Iklan</button>
                <button class="tab-btn py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent transition duration-300 ease-in-out hover:border-yellow-500" data-tab="maintenance">Maintenance</button>
            </nav>
        </div>
        
        <!-- Tab Content -->
        <div id="tab-content">
            <!-- Orders Tab -->
            <div id="orders-tab" class="tab-page">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-2xl font-bold mb-4">Daftar Pesanan</h2>
                    <div id="orders-list">
                        <!-- Orders will be loaded here -->
                        <p class="text-center text-gray-500">Memuat pesanan...</p>
                    </div>
                </div>
            </div>
            
            <!-- Products Tab -->
            <div id="products-tab" class="tab-page hidden">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-2xl font-bold mb-4">Tambah Produk/Akun</h2>
                    <form id="add-product-form" class="space-y-4">
                        <input type="text" id="product-name" placeholder="Nama Produk" class="w-full p-2 border rounded">
                        <input type="number" id="product-price" placeholder="Harga" class="w-full p-2 border rounded">
                        <textarea id="product-description" placeholder="Deskripsi" class="w-full p-2 border rounded h-24"></textarea>
                        <select id="product-category" class="w-full p-2 border rounded">
                            <option value="Steam">Steam</option>
                            <option value="Roblox">Roblox</option>
                        </select>
                        <button type="submit" class="btn">Tambah Produk</button>
                    </form>
                </div>
            </div>
            
            <!-- Users Tab -->
            <div id="users-tab" class="tab-page hidden">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-2xl font-bold mb-4">Kelola Pengguna</h2>
                     <!-- Add New User Form -->
                     <div class="bg-gray-100 p-4 rounded-lg mb-6">
                        <h3 class="text-xl font-semibold mb-2">Tambah Pengguna Baru</h3>
                        <form id="add-user-form" class="space-y-4">
                            <input type="email" id="new-user-email" placeholder="Email Pengguna" class="w-full p-2 border rounded" required>
                            <input type="password" id="new-user-password" placeholder="Password (min. 6 karakter)" class="w-full p-2 border rounded" required>
                            <select id="new-user-role" class="w-full p-2 border rounded">
                                <option value="user">Pengguna Biasa</option>
                                <option value="admin">Admin</option>
                            </select>
                            <button type="submit" class="btn w-full">Tambah Pengguna</button>
                        </form>
                    </div>
                    <div id="users-list">
                         <p class="text-center text-gray-500">Memuat data pengguna...</p>
                    </div>
                </div>
            </div>

            <!-- Ads Tab -->
            <div id="ads-tab" class="tab-page hidden">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-2xl font-bold mb-4">Kelola Iklan</h2>
                    <form id="add-ad-form" class="space-y-4">
                        <input type="text" id="ad-text" placeholder="Teks Iklan" class="w-full p-2 border rounded">
                        <button type="submit" class="btn">Pasang Iklan</button>
                    </form>
                    <div class="mt-4" id="ads-list">
                        <h3 class="text-xl font-semibold mb-2">Iklan Aktif</h3>
                        <!-- Ads will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Maintenance Tab -->
            <div id="maintenance-tab" class="tab-page hidden">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-2xl font-bold mb-4">Mode Maintenance</h2>
                    <p id="maintenance-status" class="mb-4">Status: <span class="font-bold text-green-500">Normal</span></p>
                    <button id="toggle-maintenance-btn" class="btn">Aktifkan Maintenance</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modals -->
    <!-- Purchase Confirmation Modal -->
    <div id="purchase-modal" class="modal fixed inset-0 hidden">
        <div class="modal-content p-6 text-center">
            <h3 class="text-2xl font-semibold mb-4">Yakin Pesan Sekarang?</h3>
            <p id="order-id-display" class="mb-4 text-lg font-bold text-yellow-500"></p>
            <p class="text-sm text-gray-500 mb-6">Nomor pesanan ini memudahkan admin untuk melacak pesanan Anda.</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-purchase-btn" class="btn bg-yellow-500 hover:bg-yellow-600">Ya, Pesan!</button>
                <button id="cancel-purchase-btn" class="btn bg-gray-200 hover:bg-gray-300">Batal</button>
            </div>
        </div>
    </div>
    
    <!-- Login/Register Modal -->
    <div id="auth-modal" class="modal fixed inset-0 hidden">
        <div class="modal-content p-6 text-center">
            <h3 id="auth-title" class="text-2xl font-semibold mb-4">Masuk</h3>
            <form id="auth-form" class="space-y-4">
                <input type="email" id="auth-email" placeholder="Email" class="w-full p-2 border rounded" required>
                <input type="password" id="auth-password" placeholder="Password" class="w-full p-2 border rounded" required>
                <button type="submit" id="auth-submit-btn" class="btn w-full">Masuk</button>
            </form>
            <div class="mt-4 text-sm">
                <p id="auth-toggle-text">Belum punya akun? <button id="auth-toggle-btn" class="text-yellow-500 hover:underline">Daftar sekarang</button></p>
            </div>
        </div>
    </div>
    
    <!-- Firebase JS SDKs (CDN) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, onSnapshot, updateDoc, deleteDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variabel global yang disediakan oleh lingkungan
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let purchaseData = {};

        // Inisialisasi Firebase
        function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                console.log("Firebase initialized.");
                return true;
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                return false;
            }
        }

        // Penanganan Otentikasi
        async function handleAuthentication() {
            const firebaseInitialized = initializeFirebase();
            if (!firebaseInitialized) return;
            
            // Perbaiki: Tambahkan try/catch untuk menangani error signInWithCustomToken
            if (initialAuthToken) {
                try {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Signed in with custom token.");
                } catch (error) {
                    console.error("Error signing in with custom token:", error);
                    // Jika token gagal, biarkan user tetap di halaman utama
                    // atau tawarkan opsi untuk login manual
                }
            } else {
                 console.warn("Initial auth token not available. Proceeding without automatic login.");
            }
            
            // Listener untuk state otentikasi
            onAuthStateChanged(auth, async (user) => {
                await checkMaintenanceStatus();
                if (user) {
                    console.log("User is signed in with UID:", user.uid);
                    await checkUserRole(user.uid);
                    loadData();
                } else {
                    console.log("User is signed out or not authenticated.");
                    document.getElementById('main-content').classList.remove('hidden');
                    document.getElementById('admin-panel').classList.add('hidden');
                    loadData();
                }
            });
        }
        
        async function checkUserRole(uid) {
            const userProfileRef = doc(db, `artifacts/${appId}/users/${uid}/userData/profile`);
            try {
                const docSnap = await getDoc(userProfileRef);
                const isAdmin = docSnap.exists() && docSnap.data().isAdmin;
                if (isAdmin) {
                    console.log("User is admin. Showing admin panel.");
                    document.getElementById('main-content').classList.add('hidden');
                    document.getElementById('admin-panel').classList.remove('hidden');
                    setupAdminListeners();
                    loadAdminData(uid);
                } else {
                    console.log("User is not admin. Showing main content.");
                    document.getElementById('main-content').classList.remove('hidden');
                    document.getElementById('admin-panel').classList.add('hidden');
                }
            } catch (error) {
                console.error("Error checking user role:", error);
            }
        }

        async function checkMaintenanceStatus() {
            const docRef = doc(db, `artifacts/${appId}/public/data/app_status`, "maintenance");
            try {
                const docSnap = await getDoc(docRef);
                const isMaintenance = docSnap.exists() && docSnap.data().isMaintenance;
                if (isMaintenance) {
                    document.getElementById('main-content').classList.add('hidden');
                    document.getElementById('maintenance-overlay').style.display = 'flex';
                } else {
                    document.getElementById('main-content').classList.remove('hidden');
                    document.getElementById('maintenance-overlay').style.display = 'none';
                }
            } catch (error) {
                console.error("Error checking maintenance status:", error);
            }
        }

        function loadData() {
            renderSteamAccounts();
            setupListeners();
        }

        // Data akun Steam statis
        const steamAccounts = [
            {
                id: 'acc1',
                name: 'Akun Gaming Profesional',
                price: 150000,
                games: [
                    { name: 'GTA V', logo: 'https://placehold.co/100x100/A0A0A0/ffffff?text=GTA+V' },
                    { name: 'PEAK', logo: 'https://placehold.co/100x100/E8E8E8/4A4A4A?text=PEAK' },
                    { name: 'SCHEDULE 1', logo: 'https://placehold.co/100x100/C0C0C0/ffffff?text=SCHED+1' }
                ]
            },
            {
                id: 'acc2',
                name: 'Koleksi Kota',
                price: 120000,
                games: [
                    { name: 'SimCity 5', logo: 'https://placehold.co/100x100/A0A0A0/ffffff?text=SimCity+5' },
                    { name: 'Cities Skylines', logo: 'https://placehold.co/100x100/E8E8E8/4A4A4A?text=Cities+SK' }
                ]
            },
            {
                id: 'acc3',
                name: 'Akun Pilihan',
                price: 95000,
                games: [
                    { name: 'GTA V', logo: 'https://placehold.co/100x100/A0A0A0/ffffff?text=GTA+V' },
                    { name: 'Cities Skylines', logo: 'https://placehold.co/100x100/E8E8E8/4A4A4A?text=Cities+SK' }
                ]
            }
        ];

        // Fungsi untuk merender akun Steam
        function renderSteamAccounts() {
            const container = document.getElementById('steam-accounts-container');
            container.innerHTML = '';
            steamAccounts.forEach(account => {
                const gamesHtml = account.games.map(game =>
                    `<img src="${game.logo}" alt="${game.name} Logo" class="game-logo">`
                ).join('');

                const cardHtml = `
                    <div class="card p-6 flex flex-col items-center text-center">
                        <div class="game-logo-container mb-8">
                            ${gamesHtml}
                        </div>
                        <h3 class="text-2xl font-semibold text-gray-800">${account.name}</h3>
                        <p class="text-xl font-bold text-gray-800 mt-2">Rp ${account.price.toLocaleString('id-ID')}</p>
                        <button class="btn mt-4 w-full purchase-btn" data-product="${account.name}">Pesan Sekarang</button>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }
        
        // Listener untuk tombol "Pesan Sekarang"
        function setupListeners() {
            document.querySelectorAll('.purchase-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    purchaseData.product = event.target.dataset.product;
                    purchaseData.price = event.target.closest('.card').querySelector('.text-xl.font-bold').textContent.trim();
                    
                    const userId = auth.currentUser ? auth.currentUser.uid : crypto.randomUUID();
                    const newOrderRef = doc(collection(db, `artifacts/${appId}/public/data/orders`));
                    purchaseData.orderId = newOrderRef.id;

                    // Tampilkan order ID di modal
                    document.getElementById('order-id-display').textContent = `ID Pesanan Anda: ${purchaseData.orderId}`;
                    document.getElementById('purchase-modal').classList.remove('hidden');
                });
            });
            
            document.getElementById('confirm-purchase-btn').addEventListener('click', async () => {
                document.getElementById('purchase-modal').classList.add('hidden');
                const orderRef = doc(db, `artifacts/${appId}/public/data/orders`, purchaseData.orderId);
                
                try {
                    await setDoc(orderRef, {
                        product: purchaseData.product,
                        price: purchaseData.price,
                        status: "Pending",
                        createdAt: new Date(),
                        userId: auth.currentUser ? auth.currentUser.uid : 'anon-' + crypto.randomUUID()
                    });
                    
                    const waText = encodeURIComponent(`Halo, saya ingin memesan produk "${purchaseData.product}" dengan ID pesanan: ${purchaseData.orderId}.`);
                    window.location.href = `https://wa.me/6281944589876?text=${waText}`;
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            });

            document.getElementById('cancel-purchase-btn').addEventListener('click', () => {
                document.getElementById('purchase-modal').classList.add('hidden');
            });
            
            document.getElementById('menu-btn').addEventListener('click', () => {
                const menu = document.getElementById('nav-menu');
                menu.classList.toggle('hidden');
            });

            // Login/Register button listeners
            document.getElementById('login-btn-desktop').addEventListener('click', () => {
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('auth-title').textContent = 'Masuk';
                document.getElementById('auth-submit-btn').textContent = 'Masuk';
                document.getElementById('auth-toggle-text').innerHTML = `Belum punya akun? <button id="auth-toggle-btn" class="text-yellow-500 hover:underline">Daftar sekarang</button>`;
                document.getElementById('auth-toggle-btn').addEventListener('click', toggleAuthMode);
            });

            document.getElementById('login-btn-mobile').addEventListener('click', () => {
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('auth-title').textContent = 'Masuk';
                document.getElementById('auth-submit-btn').textContent = 'Masuk';
                document.getElementById('auth-toggle-text').innerHTML = `Belum punya akun? <button id="auth-toggle-btn" class="text-yellow-500 hover:underline">Daftar sekarang</button>`;
                document.getElementById('auth-toggle-btn').addEventListener('click', toggleAuthMode);
            });
            
            // Login/Register form listener
            document.getElementById('auth-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const isRegisterMode = document.getElementById('auth-submit-btn').textContent === 'Daftar';

                try {
                    if (isRegisterMode) {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        const user = userCredential.user;
                        await setDoc(doc(db, `artifacts/${appId}/users/${user.uid}/userData/profile`), { isAdmin: false });
                        // Use a custom message box instead of alert
                        console.log('Pendaftaran berhasil! Silakan masuk.');
                        toggleAuthMode();
                    } else {
                        await signInWithEmailAndPassword(auth, email, password);
                        document.getElementById('auth-modal').classList.add('hidden');
                    }
                } catch (error) {
                    console.error("Authentication error:", error);
                    // Perbaiki: Tambahkan pesan error yang lebih spesifik
                    if (error.code === 'auth/operation-not-allowed') {
                        console.error('ERROR SPESIFIK: Operasi login/daftar belum diaktifkan di Firebase Console. Pastikan Email/Password sudah "Enabled".');
                    }
                    console.error(`Gagal ${isRegisterMode ? 'daftar' : 'masuk'}. Silakan coba lagi. Error: ${error.message}`);
                }
            });
        }
        
        function toggleAuthMode() {
            const title = document.getElementById('auth-title');
            const submitBtn = document.getElementById('auth-submit-btn');
            const toggleText = document.getElementById('auth-toggle-text');

            if (submitBtn.textContent === 'Masuk') {
                title.textContent = 'Daftar';
                submitBtn.textContent = 'Daftar';
                toggleText.innerHTML = `Sudah punya akun? <button id="auth-toggle-btn" class="text-yellow-500 hover:underline">Masuk</button>`;
            } else {
                title.textContent = 'Masuk';
                submitBtn.textContent = 'Masuk';
                toggleText.innerHTML = `Belum punya akun? <button id="auth-toggle-btn" class="text-yellow-500 hover:underline">Daftar sekarang</button>`;
            }
            document.getElementById('auth-toggle-btn').addEventListener('click', toggleAuthMode);
        }

        // Admin Panel Functions
        function handleLogout() {
            signOut(auth).then(() => {
                console.log("User signed out.");
                document.getElementById('admin-panel').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
            }).catch((error) => {
                console.error("Error signing out:", error);
            });
        }
        
        async function loadAdminData(uid) {
            console.log("Loading admin data for:", uid);
            setupAdminListeners();
            loadOrders();
            loadUsers();
            loadAds();
            checkMaintenanceStatusAdmin();
        }
        
        function setupAdminListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab', 'border-yellow-500'));
                    document.querySelectorAll('.tab-page').forEach(p => p.classList.add('hidden'));
                    btn.classList.add('active-tab', 'border-yellow-500');
                    document.getElementById(`${btn.dataset.tab}-tab`).classList.remove('hidden');
                });
            });

            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            document.getElementById('add-product-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('product-name').value;
                const price = document.getElementById('product-price').value;
                const description = document.getElementById('product-description').value;
                const category = document.getElementById('product-category').value;
                
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/products`), {
                        name, price, description, category, createdAt: new Date()
                    });
                    console.log('Produk berhasil ditambahkan!');
                    document.getElementById('add-product-form').reset();
                } catch (e) {
                    console.error("Error adding product:", e);
                    console.error('Gagal menambahkan produk.');
                }
            });
            
            document.getElementById('add-user-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('new-user-email').value;
                const password = document.getElementById('new-user-password').value;
                const role = document.getElementById('new-user-role').value;
                const isAdmin = role === 'admin';
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const newUser = userCredential.user;
                    await setDoc(doc(db, `artifacts/${appId}/users/${newUser.uid}/userData/profile`), { isAdmin: isAdmin });
                    console.log(`Pengguna ${email} berhasil ditambahkan!`);
                    document.getElementById('add-user-form').reset();
                } catch (error) {
                    console.error("Error adding user:", error);
                    console.error(`Gagal menambahkan pengguna. Error: ${error.message}`);
                }
            });

            document.getElementById('add-ad-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const adText = document.getElementById('ad-text').value;
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/ads`), {
                        text: adText, createdAt: new Date()
                    });
                    console.log('Iklan berhasil ditambahkan!');
                    document.getElementById('add-ad-form').reset();
                } catch (e) {
                    console.error("Error adding ad:", e);
                    console.error('Gagal menambahkan iklan.');
                }
            });

            document.getElementById('toggle-maintenance-btn').addEventListener('click', async () => {
                const statusRef = doc(db, `artifacts/${appId}/public/data/app_status`, "maintenance");
                try {
                    const statusDoc = await getDoc(statusRef);
                    const currentStatus = statusDoc.exists() && statusDoc.data().isMaintenance;
                    await setDoc(statusRef, { isMaintenance: !currentStatus });
                } catch (e) {
                    console.error("Error toggling maintenance:", e);
                }
            });
        }
        
        async function loadAds() {
             const adsList = document.getElementById('ads-list');
             adsList.innerHTML = '';
             onSnapshot(collection(db, `artifacts/${appId}/public/data/ads`), (snapshot) => {
                adsList.innerHTML = `<h3 class="text-xl font-semibold mb-2">Iklan Aktif</h3>`;
                if (snapshot.empty) {
                    adsList.innerHTML += `<p class="text-gray-500">Tidak ada iklan aktif.</p>`;
                    return;
                }
                snapshot.forEach(doc => {
                    const ad = doc.data();
                    adsList.innerHTML += `<p class="p-2 bg-gray-100 rounded my-2">${ad.text} <button class="text-red-500 ml-4 delete-ad-btn" data-id="${doc.id}"><i class="fas fa-trash"></i></button></p>`;
                });
                document.querySelectorAll('.delete-ad-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        try {
                            await deleteDoc(doc(db, `artifacts/${appId}/public/data/ads`, btn.dataset.id));
                        } catch (e) {
                            console.error("Error deleting ad:", e);
                        }
                    });
                });
             });
        }
        
        async function loadOrders() {
            const ordersList = document.getElementById('orders-list');
            ordersList.innerHTML = `<p class="text-center text-gray-500">Memuat pesanan...</p>`;
            
            onSnapshot(collection(db, `artifacts/${appId}/public/data/orders`), (snapshot) => {
                ordersList.innerHTML = '';
                if (snapshot.empty) {
                    ordersList.innerHTML = `<p class="text-center text-gray-500">Belum ada pesanan.</p>`;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const order = doc.data();
                    const orderId = doc.id;
                    ordersList.innerHTML += `
                        <div class="p-4 border-b border-gray-200">
                            <p class="font-semibold">ID Pesanan: <span class="font-bold text-yellow-500">${orderId}</span></p>
                            <p>Produk: ${order.product}</p>
                            <p>Harga: ${order.price}</p>
                            <p>Status: <span class="${order.status === 'Pending' ? 'text-red-500' : 'text-green-500'} font-semibold">${order.status}</span></p>
                            <div class="mt-2 space-x-2">
                                <button class="text-blue-500 edit-order-btn" data-id="${orderId}">Edit</button>
                                <button class="text-red-500 delete-order-btn" data-id="${orderId}">Hapus</button>
                                <button class="text-orange-500 warn-order-btn" data-id="${orderId}">Beri Peringatan</button>
                            </div>
                        </div>
                    `;
                });
                
                // Add event listeners for new buttons
                document.querySelectorAll('.delete-order-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        try {
                            await deleteDoc(doc(db, `artifacts/${appId}/public/data/orders`, btn.dataset.id));
                        } catch (e) { console.error("Error deleting order:", e); }
                    });
                });
                
                // Placeholder for Edit and Warn functionality
                document.querySelectorAll('.edit-order-btn, .warn-order-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        console.log(`Fitur ${btn.textContent} untuk ID ${btn.dataset.id} akan diimplementasikan.`);
                    });
                });
            });
        }
        
        async function loadUsers() {
             const usersList = document.getElementById('users-list');
             usersList.innerHTML = `<p class="text-center text-gray-500">Memuat data pengguna...</p>`;
             onSnapshot(collection(db, `artifacts/${appId}/users`), (snapshot) => {
                 usersList.innerHTML = '';
                 if (snapshot.empty) {
                    usersList.innerHTML = `<p class="text-center text-gray-500">Tidak ada pengguna terdaftar.</p>`;
                    return;
                 }
                 snapshot.forEach(userDoc => {
                     const userId = userDoc.id;
                     onSnapshot(doc(db, `artifacts/${appId}/users/${userId}/userData/profile`), (profileDoc) => {
                         const profile = profileDoc.data() || {};
                         const isAdmin = profile.isAdmin ? "Admin" : "Pengguna Biasa";
                         usersList.innerHTML += `
                            <div class="p-4 border-b border-gray-200">
                                <p class="font-semibold">ID Pengguna: <span class="font-mono text-xs">${userId}</span></p>
                                <p>Role: <span class="font-bold ${isAdmin === 'Admin' ? 'text-green-500' : 'text-blue-500'}">${isAdmin}</span></p>
                                <button class="text-purple-500 mt-2 toggle-admin-btn" data-id="${userId}" data-is-admin="${profile.isAdmin || false}">
                                    ${isAdmin === 'Admin' ? 'Jadikan Pengguna Biasa' : 'Jadikan Admin'}
                                </button>
                            </div>
                         `;
                         // Add event listeners for new buttons
                         document.querySelectorAll('.toggle-admin-btn').forEach(btn => {
                             btn.addEventListener('click', async () => {
                                 const targetId = btn.dataset.id;
                                 const isCurrentlyAdmin = btn.dataset.isAdmin === 'true';
                                 try {
                                     await setDoc(doc(db, `artifacts/${appId}/users/${targetId}/userData/profile`), { isAdmin: !isCurrentlyAdmin }, { merge: true });
                                 } catch (e) { console.error("Error toggling admin status:", e); }
                             });
                         });
                     });
                 });
             });
        }
        
        async function checkMaintenanceStatusAdmin() {
            const statusRef = doc(db, `artifacts/${appId}/public/data/app_status`, "maintenance");
            onSnapshot(statusRef, (docSnap) => {
                const isMaintenance = docSnap.exists() && docSnap.data().isMaintenance;
                const statusText = document.getElementById('maintenance-status');
                const btn = document.getElementById('toggle-maintenance-btn');
                if (isMaintenance) {
                    statusText.innerHTML = `Status: <span class="font-bold text-red-500">Maintenance</span>`;
                    btn.textContent = 'Nonaktifkan Maintenance';
                    btn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                    btn.classList.add('bg-gray-400', 'hover:bg-gray-500');
                } else {
                    statusText.innerHTML = `Status: <span class="font-bold text-green-500">Normal</span>`;
                    btn.textContent = 'Aktifkan Maintenance';
                    btn.classList.remove('bg-gray-400', 'hover:bg-gray-500');
                    btn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
                }
            });
        }

        // Shortcut Shift + A + S
        let keysPressed = {};
        document.addEventListener('keydown', (e) => {
            keysPressed[e.key] = true;
            if (keysPressed['Shift'] && keysPressed['a'] && keysPressed['s']) {
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('auth-title').textContent = 'Masuk Admin';
                document.getElementById('auth-submit-btn').textContent = 'Masuk Admin';
                document.getElementById('auth-toggle-text').classList.add('hidden');
            }
        });
        document.addEventListener('keyup', (e) => {
            delete keysPressed[e.key];
        });
        
        // Initial setup on window load
        window.onload = () => {
            // Hide loading screen after 3 seconds
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
            }, 3000);
            handleAuthentication();
        };

    </script>
</body>
</html>
